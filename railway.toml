# railway.toml - CodeIgniter 4 en Railway (Nixpacks)

[build]
builder = "nixpacks"
buildCommand = """
composer install --no-dev --optimize-autoloader --no-interaction
php spark cache:clear
php spark optimize
find . -type f -iname "dockerfile"
chmod -R 775 writable
mkdir -p writable/cache writable/logs writable/session
"""

[build.args]
NIXPACKS_PHP_VERSION = "8.2"
NIXPACKS_PKGS = "php82 php82-curl php82-gd php82-mbstring php82-mysqlnd php82-zip php82-xml php82-intl unzip git"

[build.environment]
COMPOSER_MEMORY_LIMIT = "-1"
COMPOSER_NO_INTERACTION = "1"
CI_ENVIRONMENT = "production"

[deploy]
startCommand = "php -S 0.0.0.0:$PORT -t public"

[[services]]
type = "web"
name = "codeigniter-app"
healthcheckPath = "/"
healthcheckTimeout = 30
