project = "mi-proyecto-ci4"
service = "web"

[build]
builder = "nixpacks"

[build.args]
PHP_VERSION = "8.1"
NODE_VERSION = "18"
COMPOSER_VERSION = "2"

[build.commands]
install = [
  # Instala dependencias PHP
  "composer install --ignore-platform-reqs"
]
build = [
  # Optimiza CI4 y permisos
  "php spark cache:clear",
  "php spark optimize",
  "chmod -R 775 writable",
  "mkdir -p writable/cache writable/logs writable/session"
]

[start]
# Servidor PHP embebido (Railway espera que la app escuche en $PORT)
command = "php -S 0.0.0.0:$PORT -t public"
